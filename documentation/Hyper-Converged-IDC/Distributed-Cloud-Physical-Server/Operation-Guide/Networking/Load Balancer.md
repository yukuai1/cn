# 负载均衡

## 产品概述

负载均衡可将大并发流量分发到多台后端实例（专指分布式云物理服务器），调整资源利用情况，消除由于单台设备故障对系统的影响，提高系统的可用性、扩展服务能力。目前提供基于4层（TCP、UDP）的流量监听、转发服务的DLB（Direct Load Balance），类传统DR模式LB的进化，不改变入向源IP且不需要为RS配置外网IP的4层负载均衡服务。负载均衡又称“边缘云负载均衡”。

## 使用限制

您在使用负载均衡时请注意以下使用限制：

1、目前每个京东云账户支持每个节点（region）最多申请20个负载均衡，如需更多配额通过[提交工单](https://ticket.jdcloud.com/applyorder/submit)提升配额。目前处于公测阶段。<br/>

2、负载均衡支持与弹性公网IP进行1:1绑定。<br/>

3、一个负载均衡实例可以添加多个监听器，上限为50个。<br/>

4、一个负载均衡可以添加多个虚拟服务器组，上限为20个。<br/>

5、一个虚拟服务器组组内可以添加100个实例。<br/>

6、目前包年包月的资源不允许删除。<br/>

## 计费概述

负载均衡支持包年包月和按配置两种计费方式，目前均免费。

## 开通要求

开通要求：为保证您的正常使用，开通按配置计费时您的账户余额及可用代金券之和不低于消费门槛50元。

**欠费/到期说明**

负载均衡实例免费，自身不存在欠费情况。如果负载均衡绑定的弹性公网IP欠费，将影响弹性公网IP的使用，此时对公网流量进行负载均衡的功能将不能使用。

## 计费规则

目前使用负载均衡产品免费，如绑定了弹性公网IP资源，仅需单独支付弹性公网IP费用，详见弹性公网IP[价格总览](../../Pricing/Price-Overview.md)。

## 价格总览

**包年包月&按配置**

目前使用包年包月&按配置计费负载均免费。

## 续费流程

**续费规则**

包年包月计费实例续费：延长包年包月负载均衡的使用时长。续费时间段为1个月~9个月、1年、2年、3年。如您在实例到期前操作续费，则新订单的开始时间为原订单的到期时间；如您在资源到期后续费，则新订单的开始时间为续费当天。

关联续费：（前提：负载均衡实例绑定了弹性公网IP）实例进行续费时，会显示该实例绑定的弹性公网IP，用户可按需选择需一同续费的关联资源进行续费。

## 操作指南

负载均衡主要由以下部分组成：负载均衡实例、监听器、虚拟服务器组。

**创建负载均衡实例**

打开控制台，在左侧导航栏依次点击分布式云物理服务器->负载均衡->实例，进入负载均衡实例列表页，点击 **创建** ，目前支持创建实例类型为DLB，根据需求选择 **节点** ，**网络**--网络类型（支持公网），IP版本（支持IPv4和IPv6），私网网络，绑定的服务器类型（支持分布式云物理服务器），**基本信息**--输入实例名称，描述，支持添加标签（最多可添加10个标签），**带宽**--勾选弹性公网IP，选择带宽计费模式，线路类型，带宽上限，额外上行带宽上限，（也支持暂不购买待实例创建完成后再绑定弹性公网IP），**购买量**--选择购买时长，**自定续费**--默认包年包月计费类型选中自动续费，也支持用户取消自动续费，点击 **确定** ，即可创建一个负载均衡实例。<br/>

**绑定公网IP**

打开控制台，进入负载均衡实例列表页，选择目标负载均衡，点击 **绑定公网IP** ，选择所需的弹性公网IP，即可绑定成功。<br/>

**解绑公网IP**

打开控制台，进入负载均衡实例列表页，选择目标负载均衡，点击 **解绑公网IP** ，即可将弹性公网IP解绑，解绑后负载均衡可绑定新的IP。<br/>

**编辑标签**

打开控制台，进入负载均衡实例列表页，选择目标负载均衡，点击 **编辑标签** ，即可编辑标签。<br/>

**删除负载均衡**

打开控制台，进入负载均衡实例列表页，选择目标负载均衡，点击 **删除** ，即可删除负载均衡。<br/>
说明：<br/>
1、包年包月计费方式负载均衡不支持删除，仅按配置计费方式支持删除操作；<br/>
2、负载均衡删除后，所关联的监听器、虚拟服务器组均删除，且不可恢复；<br/>
3、负载均衡删除后，后端分布式云物理服务器将继续保留，如不需保留，请前往对应页面删除，以免产生额外费用。<br/>

**负载均衡实例管理**

1.**添加监听**，点击**添加监听**跳转到监听器页面；<br/>
2.**开启/关闭**，可启动、停止负载均衡（若未负载均衡未绑定弹性公网IP，“开启”按钮置灰不可点击）；<br/>
3.**绑定/解绑弹性公网IP**，若负载均衡提供外网服务，需要绑定弹性公网IP；若不需要也可解绑弹性公网IP；<br/>
4.**续费**，支持负载均衡单独续费，也支持负载均衡和EIP关联续费；<br/>
5.**编辑标签**，支持负载均衡实例编辑标签，最多可添加10个标签；<br/>
6.点击**ID/实例名称**,跳转到实例详情页，可查看详细信息。<br/>

**监听器管理**

打开控制台，进入负载均衡实例页面，选中目标负载均衡，点击“名称”，跳转到实例详情页，点击“监听器”tab页，进入监听器列表页，点击 **创建监听器** ，根据需求选择，<br/>
**基本配置**--<br/>
**名称**：所输入的监听器名称（同一用户下负载均衡实例名称不能重复）；<br/>
**监听协议**：支持四层，其中四层包括TCP和UDP协议；<br/>
**端口**：负载均衡对外提供的端口，通常TCP使用80，范围：1-65535。监听规则创建后，协议和端口不允许修改。<br/>
**会话保持**：会话保持默认关闭，不支持开启；<br/>
**调度算法**：支持源IP-Port Hash，根据需求选择。**源IP-Port Hash**：基于（协议、源IP、目的IP、源端口、目的端口）进行普通Hash，同样的五元组的请求会分发到同一台后端服务器（前提：需要该监听器的RS内的服务器数量保持不变，若数量变化，则可能分发到不同的后端服务器）。<br/>
**获取真实IP**：默认开启，不支持关闭；<br/>

**健康检查**--负载均衡实例可以定期向后端服务器发送 Ping、尝试连接或发送请求来测试后端服务器运行的状况；<br/>
**健康检查**：默认开启（若关闭，则不支持健康检查服务）；<br/>
**响应超时时间**：健康检查响应的最大超时时间，如后端分布式云服务器在相应时间内没有正确响应，则判定为健康检查失败。限制：2-60s。响应超时时间必须小于健康检查间隔。默认值是3。<br/>
**健康检查间隔**：进行健康检查的时间间隔。限制：5-300s，默认值是5。<br/>
**健康阈值**：表示后端实例从失败到成功的连接健康次数。限制：1-10次，默认值是3。<br/>
**不健康阈值**：表示后端实例从成功到失败的连接健康检查失败次数。限制：1-10次，默认值是3。<br/>
**健康检查IP**：100.66.25.1/32
	2403:1ec0:954c:9010:0000:0000:0000:0001/128
<br/>

**后端服务器**--<br/>
选择虚拟服务器组，若没有已创建的服务器组，点击 **添加服务器器组** ，支持添加单网口或者双网口服务器，也支持指定服务器的内网IP或者别名IP,选择完成后即可创建。

完成以上步骤，点击**确定**，监听器即可创建成功。

打开控制台，在左侧导航栏依次点击云物理服务器->负载均衡->实例详情，选择监听器tab页，进入监听器列表页，点击 **监听器名称**，进入监听器详情页 ，查看详细信息。<br/>

**监听器支持操作**<br/>
1.**编辑**：监听端口及协议不可修改，其余字段可以修改<br/>
2.**开启/关闭**：支持开启和关闭状态切换。 <br/>
3.**删除**：删除监听器后，响应的后端服务器也将与此监听器解除绑定关系。<br/>

**虚拟服务器组管理**

打开控制台，在左侧导航栏依次点击云物理服务器->负载均衡->实例详情，选择虚拟服务器组tab页，进入虚拟服务器组列表页，点击 **添加虚拟服务器组** ，选择**虚拟服务器组名称**（虚拟服务器组名称不能重复）、选择实例（非必填），点击**确定**，虚拟服务器组即创建完成。<br/>

点击**虚拟服务器组**名称，进入虚拟服务器组详情页，查看详细信息。<br/>

**虚拟机服务器组支持操作**<br/>
1.**编辑**：支持编辑操作。<br/>
2.**删除**：虚拟服务器组删除条件：不与任何监听器绑定。<br/>
